<!doctype html>
<html>
<head>
  <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>


  <style>
    .green_rectangle
    {
      background-color: #00ff00
    }
    </style>

  <title>My first Vue app</title>
  <script src="https://unpkg.com/vue"></script>
</head>
<body>
  <div id="app">

</br>
<center>
  <h1>The App </h1>
</center>

  <!--
  <div v-if="post" class="content">

  <h2>{{ post.title }}</h2>
  <p>{{ post.body }}</p>
  </div>
-->

<!--
<div class="green_rectangle">
  GREEN RECT
  </div>
-->

  <div v-for="(item,index) in posts" :key="item.post" id="post-msgs" class="col-md-8">

    <div class="container-fluid">

      <div class="card mb-3" style="background-color: #40bf40;">
        <div class="container" style="margin-right: 0;">
        <button class="btn btn-success" v-on:click="delete_post(index)">X</button>
        </div>
      <div class="row no-gutters">
        <div class="col-md-4">

        </div>
        <div class="col-md-8">
          <div class="card-body">
            <h5 class="card-title">Author:</h5>
            <p class="card-text">
               {{ item }}
            </p>

          </div>
        </div>
      </div>
    </div>

    </div>

  </div>
<!--
<ul id="post-msgs">
  <li v-for="item in posts" :key="item.post">

    {{ item }}
  </li>
</ul>
-->
<center>
<p>Enter new message to post</p>

<input v-model="msg1" placeholder="Author" id="author" ref="my_input">
<input v-model="msg2" placeholder="Post" id="post" ref="msg2">
</br>

<button class="btn btn-success" onclick="app.item_submitted()"> Submit </button>
 </br>
</center>
    <div class="post2"
    v-for="(post,index) in posts"
    v-bind:item="post"
    >
        <p class="text"> {{post.text}} </p>
      </div>



  </div>
<!--
    <script>
      console.log("FETCHING:")
      var datas
      //fetch('https://reqres.in/api/users')
      fetch('http://localhost:3000/api')
      //    .then(res => console.log(res))
      .then(res => res.json())
      .then(data => setdatas(data))
      function setdatas(data)
      {
        datas = data
        console.log(datas)
      }

      //document.getElementById("post2").innerHTML = "OKZ"
-->
      </script>

  <script>
    var app = new Vue({
      el: '#app',
      data: {
        message: 'Hello Vue!',
      /*
              items: [
            { message: 'Foo' },
            { message: 'Bar' }
          ]
          */
          aa: "test",
          posts: ["","",""],
          post1: "p1",
          post2: "p2",
          post3: "p3"


        },
        methods: {
          change_msg: function (event) {
            console.log(app.aa)
          },
          delete_post: function(index)
          {
            //console.log("DELETE THIS AUTHOR")
            fetch('http://localhost:3000/api?post=" + "&type=2&id=' + (index+1))
            app.posts.splice(index,1)
            app.posts = app.posts
          },
          item_submitted: function(){
          //When submit button is clicked
            let a = document.getElementById("author").value
            let p = document.getElementById("post").value
            console.log(a + p)
            console.log("FETCHING:")
            var datas
            //fetch('https://reqres.in/api/users')
            fetch('http://localhost:3000/api?post=' + a + '&author=' + p + '&type=0')
            //    .then(res => console.log(res))
            //.then(res => res.json())
            //.then(data => setdatas(data))
            app.call_fetch()
            /*
            function setdatas(data)
            {
              datas = data
              console.log(datas)
              //alert(datas.post2)
              post1 = datas.post
              post2 = datas.post2
              post3 = datas.post3
              app.posts = [datas.post,datas.post2,datas.post3]
              //app.posts.push("")
              console.log("END SETDATAS")
            }
            */
            //console.log("END CALLFETCH")


            //Call fetch
            //app.call_fetch()
            //After finished, reload authors table display

          },

          call_fetch: function(event){
              console.log("CALL_FETCH:")
              var datas
              //fetch('https://reqres.in/api/users')
              fetch('http://localhost:3000/api?post=p&author=a&type=1')
              //    .then(res => console.log(res))
              .then(res => res.json())
              .then(data => setdatas(data))
              function setdatas(data)
              {

                datas = data
                console.log(datas)
                //alert(datas.post2)
                post1 = datas.post
                post2 = datas.post2
                post3 = datas.post3
                if (data.post == null)
                {

                    app.posts = []
                }
                else if (data.post2 == null)
                {

                    app.posts = [datas.post]
                }
                else if (data.post3 == null)
                {
                  app.posts = [datas.post,datas.post2]
                }
                else {
                  app.posts = [datas.post,datas.post2,datas.post3]
                }
                //app.posts.push("")
                console.log("END SETDATAS")
              }
              console.log("END CALLFETCH")

          },

            }
          }
    )
    console.log("calling msg change")
    app.change_msg()
    app.call_fetch()

  </script>
</body>
</html>
